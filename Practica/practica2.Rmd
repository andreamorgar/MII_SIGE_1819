---
title: "Práctica 2"
output: html_notebook
---

```{r}
library(imager)
library(magick)
library(OpenImageR)
library(raster)
```


```{r}
# ------------------------------------------------------------------------------------------

# Para leer todas las imágenes
lista.imagenes.train.0 <- list.files(path = "datos/train_images/0/", pattern = "*.jpg", 
                                     full.names = TRUE, recursive = TRUE)
length(lista.imagenes.train.0)

for (i in 1:3){
  image.i <- load.image(lista.imagenes.train.0[i])
  plot(image.i)
}

# ------------------------------------------------------------------------------------------

par(mfrow=c(2,2))

# Cargar una imagen
image <- load.image("datos/train_images/0/1a8fd6707-3.jpg")
plot(image) 

# Blurry image
image.blurry <- isoblur(image, 10)
plot(image.blurry)

# Edge detector along x-axis
image.xedges <- deriche(image, 2, order=2, axis="x")
plot(image.xedges)

# Edge detector along y-axis
image.yedges <- deriche(image, 2, order=2, axis="y") 
plot(image.yedges)

gato <- image_read("datos/train_images/0/1a8fd6707-3.jpg")
image_info(gato)

# ------------------------------------------------------------------------------------------
```


## Resize Image

```{r}
# ------------------------------------------------------------------------------------------

# https://www.rdocumentation.org/packages/OpenImageR/versions/1.1.5/topics/resizeImage
# https://www.rdocumentation.org/packages/imager/versions/0.41.2/topics/resize
image.resized <- resize(image)#, width = 256, height = 256)
plot(image)
plot(image.resized)

# ------------------------------------------------------------------------------------------

img_matrix <- matrix(imageData(img_resized), nrow = height, ncol = width * 3)
```


## RGB to gray

```{r}
# https://www.r-bloggers.com/openimager-an-image-processing-toolkit/

# ------------------------------------------------------------------------------------------

image.new <- readImage("datos/train_images/0/1a8fd6707-3.jpg")
r2g <- rgb_2gray(image.new)
imageShow(r2g) # VA PERO NO MUESTRA LA FOTO

# ------------------------------------------------------------------------------------------
```


## Image Enhancements

```{r}
# https://heartbeat.fritz.ai/image-manipulation-for-machine-learning-in-r-ff2b92069fef

# ------------------------------------------------------------------------------------------

# Read image
inp_img <- image_read("datos/train_images/0/1a8fd6707-3.jpg")

# Brightness, Saturation, Hue
mod_img <- image_modulate(inp_img, brightness = 120, saturation = 20, hue = 20)
plot(mod_img)

# ------------------------------------------------------------------------------------------
```


## Applying Filters and Effects

```{r}
# https://heartbeat.fritz.ai/image-manipulation-for-machine-learning-in-r-ff2b92069fef

# ------------------------------------------------------------------------------------------

# blurring level is controlled with two parameters - radius and sigma 
image_blur(inp_img, 10, 5) %>% plot()

# adding noise with default noise type = gaussian
image_noise(inp_img) %>% plot()

# ------------------------------------------------------------------------------------------
```



## Data augmentation

La técnica Data Augmentation que nos permite aumentar nuestro dataset de dos formas:

- Introduciendo perturbaciones en los datos originales. En nuestro ejemplo de gatos y perros, tomando una imagen original centrada, la replicamos descentrada, invirtiendo ejes…
- Utilizando distintas distribuciones. Ej: si queremos entrenar un modelo para clasificar imágenes de alta resolución, añadimos imágenes de baja resolución, con ruido… siempre manteniendo la mayor proporción de alta resolución.


```{r}
# https://www.r-bloggers.com/what-you-need-to-know-about-data-augmentation-for-machine-learning/
# https://medium.com/nanonets/how-to-use-deep-learning-when-you-have-limited-data-part-2-data-augmentation-c26971dc8ced
# https://www.doctormetrics.com/2018/10/22/datos-aumentados/#.XNgqx9Mzby8

# ------------------------------------------------------------------------------------------

# https://www.rdocumentation.org/packages/raster/versions/2.8-19/topics/flip
image.1 <- readImage("datos/train_images/0/1a8fd6707-3.jpg")

# Flip vertical
flip.vertical.image.1 <- flipImage(image.1, mode = 'vertical')
imageShow(flip.vertical.image.1)

# Flip horizontal
flip.horizontal.image.1 <- flipImage(image.1, mode = 'horizontal')
plot(flip.horizontal.image.1)

# ------------------------------------------------------------------------------------------

# Rotate 
angle <- runif(1, 5.0, 10.0)
rotate.image.1 <- rotateImage(image.1, angle)
plot(rotate.image.1)
```

